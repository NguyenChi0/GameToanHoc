CREATE DATABASE gametoanhoc;
USE gametoanhoc;

-- 2. Bảng tài khoản người chơi
CREATE TABLE taikhoan (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    score INT DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 3. Bảng danh mục phép toán
CREATE TABLE categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL        -- VD: "Tổng", "Hiệu", "Tích", "Thương", "Hỗn hợp"
);

-- 4. Bảng bài học
CREATE TABLE lessons (
    id INT AUTO_INCREMENT PRIMARY KEY,
    category_id INT,
    name VARCHAR(100) NOT NULL,      -- VD: "Tổng trong phạm vi 10"
    required_score INT DEFAULT 0,    -- Điểm cần để mở bài này
	file VARCHAR(255),
    operation VARCHAR(50),     -- VD: 'add', 'subtract', 'count', 'compare', 'order'
    level INT DEFAULT 1,       -- Mức độ bài học (1 chữ số, 2 chữ số,...)
    type VARCHAR(20) DEFAULT 'arithmetic', -- 'arithmetic' hoặc 'visual'
    FOREIGN KEY (category_id) REFERENCES categories(id)
);

-- 5. Bảng kết quả học
CREATE TABLE lesson_results (
    id INT AUTO_INCREMENT PRIMARY KEY,
    taikhoan_id INT,
    lesson_id INT,
    total_questions INT,       -- Tổng số câu
    correct_answers INT,       -- Số câu đúng
    total_score INT,           -- Tổng điểm
    played_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (taikhoan_id) REFERENCES taikhoan(id),
    FOREIGN KEY (lesson_id) REFERENCES lessons(id)
);

-- (Tùy chọn) 6. Bảng các bài học đã được mở khóa
CREATE TABLE unlocked_lessons (
    id INT AUTO_INCREMENT PRIMARY KEY,
    taikhoan_id INT,
    lesson_id INT,
    unlocked_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (taikhoan_id) REFERENCES taikhoan(id),
    FOREIGN KEY (lesson_id) REFERENCES lessons(id)
);

INSERT INTO categories (name) VALUES
('Tổng'),
('Hiệu'),
('Tích'),
('Thương'),
('Hỗn hợp'),
('Hình ảnh');

-- Tổng
INSERT INTO lessons (category_id, name, required_score, operation, level, type)
VALUES
(1, 'Tổng các phép toán 1 chữ số', 0, 'add', 1, 'arithmetic'),
(1, 'Tổng các phép toán 2 chữ số', 0, 'add', 2, 'arithmetic'),
(1, 'Tổng các phép toán 3 chữ số', 0, 'add', 3, 'arithmetic');

-- Hiệu
INSERT INTO lessons (category_id, name, required_score, operation, level, type)
VALUES
(2, 'Hiệu các phép toán 1 chữ số', 0, 'subtract', 1, 'arithmetic'),
(2, 'Hiệu các phép toán 2 chữ số', 0, 'subtract', 2, 'arithmetic'),
(2, 'Hiệu các phép toán 3 chữ số', 0, 'subtract', 3, 'arithmetic');

-- Tích
INSERT INTO lessons (category_id, name, required_score, operation, level, type)
VALUES
(3, 'Tích các phép toán 1 chữ số', 0, 'multiply', 1, 'arithmetic'),
(3, 'Tích các phép toán 2 chữ số', 0, 'multiply', 2, 'arithmetic'),
(3, 'Tích các phép toán 3 chữ số', 0, 'multiply', 3, 'arithmetic');

-- Thương
INSERT INTO lessons (category_id, name, required_score, operation, level, type)
VALUES
(4, 'Thương các phép toán 1 chữ số', 0, 'divide', 1, 'arithmetic'),
(4, 'Thương các phép toán 2 chữ số', 0, 'divide', 2, 'arithmetic'),
(4, 'Thương các phép toán 3 chữ số', 0, 'divide', 3, 'arithmetic');

-- Hỗn hợp
INSERT INTO lessons (category_id, name, required_score, operation, level, type)
VALUES
(5, 'Hỗn hợp các phép toán 1 chữ số', 0, 'mix', 1, 'arithmetic'),
(5, 'Hỗn hợp các phép toán 2 chữ số', 0, 'mix', 2, 'arithmetic'),
(5, 'Hỗn hợp các phép toán 3 chữ số', 0, 'mix', 3, 'arithmetic');

-- Hình ảnh
INSERT INTO lessons (category_id, name, required_score, operation, level, type)
VALUES
(6, 'Sắp xếp số từ 1 đến 10', 0, 'order', 1, 'visual'),
(6, 'Đếm số con vật', 0, 'count', 1, 'visual'),
(6, 'So sánh số lượng trái cây', 0, 'compare', 1, 'visual');


select * from lessons
select * from categories
